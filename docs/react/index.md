# React åŸºç¡€çŸ¥è¯†

## é—®é¢˜ 1ï¼šReact ä¸­ä¸ºä»€ä¹ˆè¦è®¾è®¡ Hookï¼Œä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜

- **ç®€åŒ–çŠ¶æ€ç®¡ç†å’Œå‰¯ä½œç”¨**ï¼šHooks å…è®¸ä½ ç›´æ¥åœ¨å‡½æ•°ç»„ä»¶ä¸­å¤„ç†çŠ¶æ€å’Œå‰¯ä½œç”¨ï¼Œæ— éœ€ç±»å’Œå¤æ‚çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚
- **é€»è¾‘æ‹†åˆ†ä¸é‡ç”¨**ï¼šé€šè¿‡è‡ªå®šä¹‰ Hooksï¼Œä½ å¯ä»¥å°†å¤æ‚çš„é€»è¾‘æ‹†åˆ†æˆå°çš„å¯é‡ç”¨å•å…ƒï¼Œä»è€Œä½¿ä»£ç æ›´ç®€æ´ã€å¯è¯»ã€‚

## é—®é¢˜ 2ï¼šç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

React ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šæŒ‚è½½é˜¶æ®µã€æ›´æ–°é˜¶æ®µå’Œå¸è½½é˜¶æ®µã€‚

- æŒ‚è½½é˜¶æ®µåŒ…æ‹¬`constructor`ã€`render`ã€`componentDidMount`ç­‰æ–¹æ³•ï¼Œç”¨äºåˆå§‹åŒ–ç»„ä»¶ã€æ¸²æŸ“åˆ°çœŸå® DOM å’Œå¤„ç†å‰¯ä½œç”¨ã€‚
- æ›´æ–°é˜¶æ®µåŒ…æ‹¬`shouldComponentUpdate`ã€`render`ã€`componentDidUpdate`ç­‰æ–¹æ³•ï¼Œç”¨äºæ§åˆ¶ç»„ä»¶çš„é‡æ–°æ¸²æŸ“å’Œå¤„ç†æ›´æ–°åçš„å‰¯ä½œç”¨ã€‚
- å¸è½½é˜¶æ®µåŒ…æ‹¬`componentWillUnmount`æ–¹æ³•ï¼Œç”¨äºæ¸…ç†ç»„ä»¶äº§ç”Ÿçš„å‰¯ä½œç”¨å’Œèµ„æº

> æ–°ç”Ÿå‘½å‘¨æœŸåªæœ‰è¿™ä¸ªå¸¦`will`çš„æ²¡æœ‰è¢«ç§»é™¤ï¼Œå…¶ä½™ 3 ä¸ª`componentWillMount`ã€`componentWillReceiveProps`ã€`componentWillUpdate`è¢«ç§»é™¤äº†ã€‚

## é—®é¢˜ 3ï¼šReact ç»„ä»¶å¯è¯·æ±‚æ•°æ®ç”Ÿå‘½å‘¨æœŸé’©å­

- `componentDidMount`ï¼šç»„ä»¶æŒ‚è½½åç«‹å³è°ƒç”¨ï¼Œåœ¨æ­¤æ–¹æ³•ä¸­å¯ä»¥å‘èµ·è¯·æ±‚ï¼Œå¹¶æ›´æ–°ç»„ä»¶çš„çŠ¶æ€æˆ– propsã€‚
- `componentDidUpdate`ï¼šç»„ä»¶æ›´æ–°åç«‹å³è°ƒç”¨ï¼Œåœ¨æ­¤æ–¹æ³•ä¸­å¯ä»¥æ ¹æ® props æˆ– state çš„å˜åŒ–å‘èµ·è¯·æ±‚ï¼Œ

## é—®é¢˜ 4ï¼šä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰

é«˜é˜¶ç»„ä»¶ï¼ˆHigher-Order Componentï¼‰æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒ<u>æ¥æ”¶ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶</u>ã€‚é«˜é˜¶ç»„ä»¶çš„ä½œç”¨æ˜¯å¤ç”¨ç»„ä»¶çš„é€»è¾‘ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¢å¼ºåçš„ç»„ä»¶ã€‚

## é—®é¢˜ 5ï¼šå—æ§ç»„ä»¶ å’Œ éå—æ§ç»„ä»¶

- **å—æ§ç»„ä»¶**ï¼šè¡¨å•å…ƒç´ çš„æ•°æ®æ˜¯ç”± React çš„ State æ¥ç®¡ç†ã€‚

> å…¶å®å°±æ˜¯å®ç°äº†ä¸€ä¸ªç±»ä¼¼ Vue çš„ v-model çš„æœºåˆ¶ï¼Œé€šè¿‡ onChange äº‹ä»¶æ¥æ›´æ–° valueï¼Œè¿™æ ·å°±å®ç°äº†å—æ§ç»„ä»¶ã€‚

::: details ä¾‹å¦‚ï¼š

æˆ‘ä»¬åœ¨ç•Œé¢çš„è¾“å…¥æ¡†ä¸­è¾“å…¥å†…å®¹ï¼Œè¿™æ—¶å€™ä½ ä¼šå‘ç°è¿™ä¸ª value æ˜¯åªè¯»çš„ï¼Œæ— æ³•ä¿®æ”¹ï¼Œè¿˜ä¼šæŠ¥é”™

```tsx
import React, { useState } from 'react'

const App: React.FC = () => {
  const [value, setValue] = useState('')
  return (
    <>
      <input
        type='text'
        value={value}
      />
      <div>{value}</div>
    </>
  )
}

export default App
```

å½“ç”¨æˆ·è¾“å…¥å†…å®¹çš„æ—¶å€™ï¼Œvalue å¹¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å®ç°ä¸€ä¸ª onChange äº‹ä»¶æ¥æ›´æ–° valueã€‚

```tsx
import React, { useState } from 'react'

const App: React.FC = () => {
  const [value, setValue] = useState('')
  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setValue(e.target.value)
  }
  return (
    <>
      <input
        type='text'
        value={value}
        onChange={handleChange}
      />
      <div>{value}</div>
    </>
  )
}

export default App
```

:::

```jsx
import React, { useState } from 'react'

// å—æ§ç»„ä»¶
function ControlledComponent() {
  const [inputValue, setInputValue] = useState('')

  const handleChange = (event) => {
    setInputValue(event.target.value)
  }

  return (
    <div>
      <input
        type='text'
        value={inputValue}
        onChange={handleChange}
      />
      <p>è¾“å…¥çš„å†…å®¹: {inputValue}</p>
    </div>
  )
}

export default ControlledComponent
```

- **éå—æ§ç»„ä»¶**ï¼šæ˜¯æŒ‡è¡¨å•å…ƒç´ ä¸å— React çš„ State ç®¡ç†ã€‚å®ƒçš„çŠ¶æ€é€šå¸¸é€šè¿‡ ref ä» DOM ä¸­è·å–ã€‚

> é‡‡ç”¨ `defaultValue`ï¼Œå˜ä¸ºéå—æ§ç»„ä»¶

```jsx {13}
import React, { useState, useRef } from 'react'
const App = () => {
  const value = 'wifi'
  const inputRef = useRef(null)
  const handleChange = () => {
    console.log(inputRef.current?.value)
  }
  return (
    <>
      <input
        type='text'
        onChange={handleChange}
        defaultValue={value}
        ref={inputRef}
      />
    </>
  )
}

export default App
```

- **ç‰¹æ®Šçš„éå—æ§ç»„ä»¶**ï¼šå¯¹äº file ç±»å‹çš„è¡¨å•æ§ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»„ä»¶ï¼Œå› ä¸ºå®ƒçš„å€¼åªèƒ½ç”±ç”¨æˆ·é€šè¿‡æ–‡ä»¶é€‰æ‹©æ“ä½œæ¥è®¾ç½®ï¼Œè€Œä¸èƒ½é€šè¿‡ç¨‹åºç›´æ¥è®¾ç½®ï¼Œæ‰€ä»¥<u>`file`åªèƒ½æ˜¯éå—æ§ç»„ä»¶</u>ã€‚

> å—æ§ç»„ä»¶é€‚ç”¨äºæ‰€æœ‰è¡¨å•å…ƒç´ ï¼ŒåŒ…æ‹¬ inputã€textareaã€select ç­‰ã€‚ä½†æ˜¯é™¤äº† `input type="file"` å¤–ï¼Œå…¶ä»–è¡¨å•å…ƒç´ éƒ½æ¨èä½¿ç”¨å—æ§ç»„ä»¶ã€‚

## é—®é¢˜ 6ï¼šç±»ç»„ä»¶ å’Œ å‡½æ•°å¼ç»„ä»¶ åŒºåˆ«

å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶æ—©èµ·æ˜¯ä¸¤ç§å·®å¼‚æ¯”è¾ƒå¤§çš„å†™æ³•ï¼Œç±»ç»„ä»¶æ”¯æŒçŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œè€Œå‡½æ•°ç»„ä»¶æœ€åˆåªèƒ½ä½œä¸ºçº¯å±•ç¤ºç»„ä»¶ï¼Œä½†ä» react16.8 å¼€å§‹ï¼Œå‡½æ•°ç»„ä»¶é€šè¿‡å¼•å…¥ hookï¼Œä¾‹å¦‚`useState`å’Œ`useEffect`ç­‰ï¼Œä¹Ÿå¯ä»¥å®ç°çŠ¶æ€ç®¡ç†ï¼Œå‰¯ä½œç”¨å¤„ç†ï¼Œè®©å‡½æ•°ç»„ä»¶å…·å¤‡ç±»ç»„ä»¶çš„åŠŸèƒ½ã€‚ä¸è¿‡ä¸¤è€…çš„è¿è¡Œæœºåˆ¶è¿˜æ˜¯æœ‰æ˜æ˜¾å·®å¼‚ï¼š

1. ç±»ç»„ä»¶ä¼šåœ¨åˆæ¬¡æ¸²æŸ“æ—¶è¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå®ä¾‹ä¸Šä¼šæŒ‚è½½ç»„ä»¶çš„ stateã€props å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç­‰ï¼Œåç»­æ¯æ¬¡æ›´æ–° react åªéœ€è¦å¤ç”¨è¿™ä¸ªå®ä¾‹ï¼Œè°ƒç”¨å…¶ render æ–¹æ³•ï¼Œä»¥åŠç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚
2. ä½†æ˜¯å‡½æ•°ç»„ä»¶ä¸åŒï¼Œæ¯ä¸€æ¬¡æ›´æ–°ï¼Œæœ¬è´¨éƒ½æ˜¯å¯¹ç»„ä»¶å‡½æ•°çš„é‡æ–°è°ƒç”¨ï¼Œå‡½æ•°å†…éƒ¨çš„å˜é‡ä¼šé‡æ–°å£°æ˜ï¼Œreact é€šè¿‡ hook çš„å†…éƒ¨æœºåˆ¶æ¥ä¿ç•™å’Œæ¢å¤çŠ¶æ€ï¼Œæ¯”å¦‚é€šè¿‡é—­åŒ…+hook ç´¢å¼•ï¼ˆæœ¬è´¨æ˜¯`workInProgressHook`æŒ‡é’ˆï¼‰æ¥è®°å½•ä¸Šä¸€æ¬¡çš„ stateã€effect ç­‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ hook è°ƒç”¨é¡ºåºä¸èƒ½å˜çš„åŸå› ã€‚

::: details hooks ç´¢å¼•

**Hooks ç´¢å¼•**æ˜¯ React å†…éƒ¨ç”¨äºè¿½è¸ªç»„ä»¶ä¸­ Hooks è°ƒç”¨é¡ºåºçš„ã€Œéšå½¢æŒ‡é’ˆã€ï¼Œç¡®ä¿æ¯æ¬¡æ¸²æŸ“æ—¶ï¼Œ`useState`ã€`useEffect` ç­‰ Hooks çš„æ‰§è¡Œé¡ºåºä¸åˆå§‹åŒ–æ—¶å®Œå…¨ä¸€è‡´ï¼Œä»è€Œæ­£ç¡®å…³è”å¯¹åº”çš„çŠ¶æ€å’Œå‰¯ä½œç”¨ã€‚

æ ¸å¿ƒé€»è¾‘å¯ç®€åŒ–ä¸º 3 ç‚¹ï¼š

1. ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶ï¼ŒHooks ç´¢å¼•ä» 0 å¼€å§‹ï¼Œæ¯è°ƒç”¨ä¸€ä¸ª Hookï¼Œç´¢å¼•å°± +1ï¼Œå¹¶å°† Hook çš„çŠ¶æ€ã€å‰¯ä½œç”¨ç­‰ä¿¡æ¯å­˜å…¥ã€ŒHook é“¾è¡¨ã€ã€‚
2. ç»„ä»¶æ›´æ–°æ¸²æŸ“æ—¶ï¼ŒHooks ç´¢å¼•é‡ç½®ä¸º 0ï¼Œå†æ¬¡æŒ‰é¡ºåºè°ƒç”¨ Hooksï¼Œé€šè¿‡ç´¢å¼•ä»é“¾è¡¨ä¸­è¯»å–å¯¹åº”çš„æ•°æ®ï¼Œä¿è¯çŠ¶æ€ä¸é”™ä¹±ã€‚
3. è‹¥åœ¨æ¡ä»¶åˆ¤æ–­ï¼ˆå¦‚ `if`ï¼‰ã€å¾ªç¯ï¼ˆå¦‚ `for`ï¼‰ä¸­è°ƒç”¨ Hooksï¼Œä¼šç ´åç´¢å¼•é¡ºåºï¼Œå¯¼è‡´ React æ— æ³•åŒ¹é…æ­£ç¡®çš„ Hook æ•°æ®ï¼Œå¼•å‘ bugsã€‚

> è¿™ä¸ªç´¢å¼•ä¸æ˜¯æ•°å­—ï¼Œæ˜¯`workInProgressHook`æŒ‡é’ˆ

:::

3. å¦å¤–å‡½æ•°ç»„ä»¶ä¸ä¾èµ– thisï¼Œé¿å…äº†ä¸Šä¸‹æ–‡æ··ä¹±çš„é—®é¢˜ï¼Œè€Œç±»ç»„ä»¶ç»å¸¸éœ€è¦æ‰‹åŠ¨ç»‘å®š thisï¼Œæˆ–ä½¿ç”¨ç®­å¤´å‡½æ•°æ¥è§£å†³ã€‚
4. å‡½æ•°ç»„ä»¶å¯ä»¥æ›´æ–¹ä¾¿çš„æ‹†åˆ†é€»è¾‘ï¼Œä¾‹å¦‚è‡ªå®šä¹‰ hook æ¥æŠ½ç¦»å‰¯ä½œç”¨å’ŒçŠ¶æ€ï¼Œä½¿å…¶ä»£ç é€»è¾‘æ›´æ¸…æ™°ï¼Œå¤ç”¨æ€§é«˜

æ— è®ºæ˜¯å“ªç§ç»„ä»¶ï¼Œreact éƒ½ä¼šå°†ä»–ä»¬è½¬ä¸º fiber èŠ‚ç‚¹ï¼Œäº¤ç”±è°ƒåº¦å™¨ç»Ÿä¸€å¤„ç†ï¼Œè¿›å…¥ reconciliationï¼ˆè°ƒåº¦é˜¶æ®µï¼‰ å’Œ commitï¼ˆæäº¤é˜¶æ®µï¼‰ é˜¶æ®µå®Œæˆæ›´æ–°ï¼Œç»„ä»¶çš„æ›´æ–°ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚

## é—®é¢˜ 7ï¼šReact ä¸­ç»„ä»¶é€šä¿¡æ–¹å¼

- çˆ¶ä¼ å­
  - propsã€Context ä¸Šä¸‹æ–‡ï¼ˆuseContextï¼‰
- å­ä¼ çˆ¶
  - å›è°ƒå‡½æ•°ï¼ˆé€šè¿‡çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ props ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼Œç”±å­ç»„ä»¶å‘å‡½æ•°ä¸­ä¼ é€’å‚æ•°ï¼Œçˆ¶ç»„ä»¶æ¥æ”¶ï¼‰
- å­å­™ç»„ä»¶
  - Context ä¸Šä¸‹æ–‡ï¼ˆuseContextï¼‰
- å…„å¼Ÿç»„ä»¶
  - ç±»ä¼¼å…¨å±€äº‹ä»¶æ€»çº¿ï¼ˆä¾‹å¦‚ï¼šç¬¬ä¸‰æ–¹åº“ PubSubJSï¼‰ï¼ŒåŸç†ï¼šæ¶ˆæ¯çš„å‘å¸ƒè®¢é˜…æœºåˆ¶
  - çŠ¶æ€ç®¡ç†åº“ï¼ˆreduxã€zustandï¼‰

## é—®é¢˜ 8ï¼šReact æ˜¯ mvvm æ¡†æ¶å—ï¼Ÿ

- React ä¸æ˜¯ä¸€ä¸ªå…¸å‹çš„ MVVMï¼ˆModel-View-ViewModelï¼‰æ¡†æ¶ã€‚
- React å¼ºè°ƒå•å‘æ•°æ®æµçš„æ¦‚å¿µï¼Œå…¶ä¸­æ•°æ®ä»çˆ¶ç»„ä»¶é€šè¿‡ props ä¼ é€’ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶é€šè¿‡å›è°ƒå‡½æ•°å°†çŠ¶æ€æ›´æ”¹ä¼ é€’å›çˆ¶ç»„ä»¶ã€‚è¿™ç§å•å‘æ•°æ®æµçš„æ¨¡å‹æœ‰åŠ©äºæ„å»ºå¯é¢„æµ‹å’Œå¯ç»´æŠ¤çš„ç»„ä»¶ï¼Œä½†ä¸å…¸å‹çš„åŒå‘ç»‘å®šçš„ MVVM æ¨¡å¼ä¸åŒã€‚

## é—®é¢˜ 9ï¼šReact æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

1. ä½¿ç”¨ React.memo()æ¥ç¼“å­˜ç»„ä»¶ï¼Œè¯¥ç»„ä»¶åœ¨ props æ²¡æœ‰å˜åŒ–æ—¶é¿å…ä¸å¿…è¦çš„æ¸²æŸ“ã€‚
2. ä½¿ç”¨ React.lazy()å’Œ Suspense æ¥å»¶è¿ŸåŠ è½½ç»„ä»¶ã€‚å¯é™ä½åˆå§‹åŠ è½½æ—¶é—´ï¼Œå¹¶æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚
3. ä½¿ç”¨ React.useCallback()å’Œ React.useMemo()æ¥ç¼“å­˜å‡½æ•°å’Œè®¡ç®—ç»“æœï¼Œé¿å…ä¸å¿…è¦çš„å‡½æ•°è°ƒç”¨å’Œè®¡ç®—ã€‚
4. ä½¿ç”¨ React.Fragment æ¥é¿å…ä¸å¿…è¦çš„ DOM èŠ‚ç‚¹ã€‚å¯å‡å°‘ DOM èŠ‚ç‚¹æ•°é‡ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚

## é—®é¢˜ 10ï¼šrefs çš„ä½œç”¨

åœ¨ React ä¸­ï¼Œrefsï¼ˆå¼•ç”¨ï¼‰æ˜¯ç”¨äºè®¿é—®ç»„ä»¶æˆ– DOM å…ƒç´ çš„æ–¹æ³•ã€‚

1. **è®¿é—®ç»„ä»¶å®ä¾‹**ï¼šé€šè¿‡ refsï¼Œå¯ä»¥è·å–åˆ°ç»„ä»¶çš„å®ä¾‹ï¼Œä»è€Œå¯ä»¥ç›´æ¥è°ƒç”¨ç»„ä»¶çš„æ–¹æ³•æˆ–è®¿é—®ç»„ä»¶çš„å±æ€§ã€‚è¿™åœ¨æŸäº›æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚éœ€è¦æ‰‹åŠ¨è§¦å‘ç»„ä»¶çš„æŸä¸ªæ–¹æ³•æˆ–è·å–ç»„ä»¶çš„çŠ¶æ€ã€‚
2. **è®¿é—® DOM å…ƒç´ **ï¼šé€šè¿‡ refsï¼Œå¯ä»¥è·å–åˆ° React ç»„ä»¶ä¸­çš„ DOM å…ƒç´ ï¼Œä»è€Œå¯ä»¥ç›´æ¥æ“ä½œ DOMï¼Œä¾‹å¦‚æ”¹å˜æ ·å¼ã€è·å–è¾“å…¥æ¡†çš„å€¼ç­‰ã€‚è¿™åœ¨éœ€è¦ç›´æ¥æ“ä½œ DOM çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œä½†åœ¨ React ä¸­åº”è¯¥å°½é‡é¿å…ç›´æ¥æ“ä½œ DOMï¼Œè€Œæ˜¯é€šè¿‡çŠ¶æ€å’Œå±æ€§æ¥æ§åˆ¶ç»„ä»¶çš„æ¸²æŸ“ã€‚

## é—®é¢˜ 11ï¼šReact é¡¹ç›®æ˜¯å¦‚ä½•æ•è·é”™è¯¯çš„ï¼Ÿ

åœ¨ react16 ä¸­å¼•å…¥äº†é”™è¯¯è¾¹ç•Œï¼Œæ¥æ•è·é”™è¯¯ï¼Œåšå‡ºé™çº§å¤„ç†ã€‚

- ä½¿ç”¨ `static getDerivedStateFromError()` åš UI é™çº§ã€‚
- ä½¿ç”¨ `componentDidCatch()` æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚

**å¯ä»¥æ•è·çš„é”™è¯¯**ï¼šæ¸²æŸ“å±‚é¢çš„é”™è¯¯ å’Œ ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­çš„é”™è¯¯ã€‚

> âš ï¸ æ³¨æ„ï¼šä»¥ä¸‹å¼‚å¸¸æ— æ³•æ•è·
>
> 1. äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æŠ›å‡ºçš„å¼‚å¸¸
>
> 2. å¼‚æ­¥ä»£ç ä¸­æŠ›å‡ºçš„å¼‚å¸¸
>
> 3. é”™è¯¯è¾¹ç•Œè‡ªèº«æŠ›å‡ºçš„é”™è¯¯ï¼šå¦‚æœé”™è¯¯è¾¹ç•Œç»„ä»¶æœ¬èº«æŠ›å‡ºäº†é”™è¯¯ï¼Œåˆ™å®ƒæ— æ³•æ•è·è¯¥é”™è¯¯ã€‚

::: code-group

```tsx [ErrorBoundaryç»„ä»¶]
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props)
    this.state = { hasError: false }
  }

  static getDerivedStateFromError(error) {
    // æ›´æ–° state ä½¿ä¸‹ä¸€æ¬¡æ¸²æŸ“èƒ½å¤Ÿæ˜¾ç¤ºé™çº§åçš„ UIã€‚
    return { hasError: true }
  }

  componentDidCatch(error, errorInfo) {
    // ä½ åŒæ ·å¯ä»¥å°†é”™è¯¯æ—¥å¿—ä¸ŠæŠ¥ç»™æœåŠ¡å™¨ã€‚
    logErrorToMyService(error, errorInfo)
  }

  render() {
    if (this.state.hasError) {
      // ä½ å¯ä»¥è‡ªå®šä¹‰é™çº§åçš„ UI å¹¶æ¸²æŸ“ã€‚
      return <h1>Something went wrong.</h1>
    }
    return this.props.children
  }
}
```

```tsx [ä½¿ç”¨ErrorBoundary]
<ErrorBoundary>
  <MyComponent />
  {/* ...å…¶ä½™ä¸šåŠ¡ç»„ä»¶ */}
</ErrorBoundary>
```

:::

## é—®é¢˜ 12ï¼šReact çš„äº‹ä»¶åˆæˆæœºåˆ¶

åœ¨ React ä¸­ï¼Œäº‹ä»¶åˆæˆæœºåˆ¶ï¼ˆSyntheticEventï¼‰æ˜¯ React å¯¹æµè§ˆå™¨åŸç”Ÿäº‹ä»¶ç³»ç»Ÿçš„ä¸€å±‚å°è£…ï¼Œå®ƒå®šä¹‰äº†ä¸€å¥—ç»Ÿä¸€çš„äº‹ä»¶å¤„ç†æ¥å£ï¼Œè®©å¼€å‘è€…åœ¨**ä¸åŒæµè§ˆå™¨ç¯å¢ƒ**ä¸‹èƒ½å¤Ÿä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†äº‹ä»¶ã€‚

### **äº‹ä»¶åˆæˆæœºåˆ¶çš„æ ¸å¿ƒåŸç†**

1. **äº‹ä»¶å§”æ‰˜ï¼ˆEvent Delegationï¼‰-> æ€§èƒ½ä¼˜åŒ–**  
   React å¹¶ä¸ä¼šå°†äº‹ä»¶å¤„ç†å™¨ç›´æ¥ç»‘å®šåˆ° DOM å…ƒç´ ä¸Šï¼Œè€Œæ˜¯å°†æ‰€æœ‰äº‹ä»¶å§”æ‰˜åˆ°æ ¹èŠ‚ç‚¹ï¼ˆ`root` å®¹å™¨ï¼‰ã€‚å½“äº‹ä»¶è§¦å‘æ—¶ï¼Œæµè§ˆå™¨ä¼šå…ˆæ‰§è¡ŒåŸç”Ÿäº‹ä»¶æµï¼ˆæ•è· â†’ ç›®æ ‡ â†’ å†’æ³¡ï¼‰ï¼Œæœ€ç»ˆç”±æ ¹èŠ‚ç‚¹çš„ç»Ÿä¸€ç›‘å¬å™¨æ¥æ”¶ï¼Œå†ç”± React å†…éƒ¨æ¨¡æ‹Ÿä¸€å¥—äº‹ä»¶å†’æ³¡/æ•è·æœºåˆ¶ï¼Œå°†äº‹ä»¶åˆ†å‘åˆ°å¯¹åº”çš„ç»„ä»¶ã€‚

   - React 17 ä¹‹å‰å°†äº‹ä»¶å§”æ‰˜åˆ° `document` å±‚çº§ã€‚React 17+ æ”¹ä¸ºå§”æ‰˜åˆ°æ¸²æŸ“çš„`æ ¹å®¹å™¨`ï¼ˆå¦‚ ReactDOM.render æŒ‚è½½çš„èŠ‚ç‚¹ï¼‰ã€‚å‡å°‘å†…å­˜å ç”¨ï¼ŒåŠ¨æ€æ·»åŠ å…ƒç´ æ— éœ€é‡æ–°ç»‘å®šäº‹ä»¶ã€‚
   - DOM äº‹ä»¶ ç›´æ¥ç»‘å®šåˆ°å…ƒç´ ï¼Œå¤§é‡äº‹ä»¶ç›‘å¬æ—¶å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚

2. **åˆæˆäº‹ä»¶å¯¹è±¡ï¼ˆSyntheticEventï¼‰**  
   å½“äº‹ä»¶è§¦å‘æ—¶ï¼ŒReact ä¼šåˆ›å»ºä¸€ä¸ª **åˆæˆäº‹ä»¶å¯¹è±¡**ï¼ˆè€ŒéåŸç”Ÿäº‹ä»¶å¯¹è±¡ï¼‰ï¼Œå®ƒå°è£…äº†åŸç”Ÿäº‹ä»¶çš„å¸¸ç”¨å±æ€§å’Œæ–¹æ³•ï¼ˆå¦‚ `stopPropagation()`ã€`preventDefault()`ã€`target` ç­‰ï¼‰ï¼Œå¹¶ç¡®ä¿åœ¨ä¸åŒæµè§ˆå™¨ä¸­è¡¨ç°ä¸€è‡´ã€‚

::: details äº‹ä»¶æ± 

**äº‹ä»¶æ± **ï¼ˆEvent Poolingï¼‰ æ˜¯ React æ—©æœŸä¸ºä¼˜åŒ–æ€§èƒ½å¼•å…¥çš„æœºåˆ¶ï¼Œç”¨äºå¤ç”¨åˆæˆäº‹ä»¶å¯¹è±¡ã€‚

1. **äº‹ä»¶æ± çš„æ ¸å¿ƒä½œç”¨**ï¼šå‡å°‘å†…å­˜åˆ†é…å’Œåƒåœ¾å›æ”¶çš„å¼€é”€

å½“ä¸€ä¸ªäº‹ä»¶ï¼ˆå¦‚ `onClick`ï¼‰è¢«è§¦å‘æ—¶ï¼ŒReact ä¼šä»äº‹ä»¶æ± ä¸­å–å‡ºä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡ï¼Œå°†åŸç”Ÿäº‹ä»¶çš„å±æ€§ï¼ˆå¦‚ `target`ã€`type`ã€`preventDefault` ç­‰ï¼‰å¤åˆ¶åˆ°è¯¥å¯¹è±¡ä¸Šï¼Œä¾›äº‹ä»¶å¤„ç†å‡½æ•°ä½¿ç”¨ã€‚  
å½“äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼ŒReact ä¼š**æ¸…ç©ºè¯¥åˆæˆäº‹ä»¶å¯¹è±¡çš„æ‰€æœ‰å±æ€§**ï¼Œå¹¶å°†å…¶æ”¾å›äº‹ä»¶æ± ï¼Œä»¥ä¾¿ä¸‹æ¬¡äº‹ä»¶è§¦å‘æ—¶é‡å¤åˆ©ç”¨ã€‚

2. äº‹ä»¶æ± çš„ã€Œå‘ã€ï¼š**å¼‚æ­¥è®¿é—®é—®é¢˜**

ç”±äºäº‹ä»¶æ± ä¼šåœ¨äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œåæ¸…ç©ºåˆæˆäº‹ä»¶å¯¹è±¡çš„å±æ€§ï¼Œ**å¦‚æœåœ¨å¼‚æ­¥ä»£ç ä¸­è®¿é—®åˆæˆäº‹ä»¶çš„å±æ€§ï¼Œä¼šå¾—åˆ° `null` æˆ– `undefined`**ã€‚

ä¾‹å¦‚ï¼Œåœ¨ React 16 åŠä¹‹å‰ç‰ˆæœ¬ä¸­ï¼š

```jsx
function handleClick(event) {
  console.log(event.target) // æ­£å¸¸è¾“å‡ºï¼ˆåŒæ­¥è®¿é—®ï¼‰

  setTimeout(() => {
    console.log(event.target) // è¾“å‡º nullï¼ˆå¼‚æ­¥è®¿é—®ï¼Œäº‹ä»¶å·²è¢«å›æ”¶ï¼‰
  }, 0)
}

;<button onClick={handleClick}>ç‚¹å‡»</button>
```

è§£å†³æ–¹æ¡ˆï¼š`event.persist()`

ä¸ºäº†åœ¨å¼‚æ­¥åœºæ™¯ä¸­è®¿é—®åˆæˆäº‹ä»¶çš„å±æ€§ï¼ŒReact æä¾›äº† `event.persist()` æ–¹æ³•ã€‚è°ƒç”¨è¯¥æ–¹æ³•åï¼Œåˆæˆäº‹ä»¶å¯¹è±¡ä¼š**ä»äº‹ä»¶æ± ä¸­ç§»é™¤**ï¼Œå…¶å±æ€§ä¸ä¼šè¢«æ¸…ç©ºï¼Œå¯åœ¨å¼‚æ­¥ä»£ç ä¸­å®‰å…¨è®¿é—®ï¼š

```jsx
function handleClick(event) {
  event.persist() // å°†äº‹ä»¶ä»æ± ä¸­ç§»é™¤ï¼Œå±æ€§ä¸ä¼šè¢«æ¸…ç©º
  console.log(event.target) // æ­£å¸¸è¾“å‡º

  setTimeout(() => {
    console.log(event.target) // æ­£å¸¸è¾“å‡ºï¼ˆå¼‚æ­¥è®¿é—®æœ‰æ•ˆï¼‰
  }, 0)
}
```

3. æ€»ç»“

- äº‹ä»¶æ± æ˜¯ React æ—©æœŸä¸ºä¼˜åŒ–æ€§èƒ½è®¾è®¡çš„åˆæˆäº‹ä»¶å¤ç”¨æœºåˆ¶ï¼Œä¼šåœ¨äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œåæ¸…ç©ºäº‹ä»¶å±æ€§ï¼›
- React 16 åŠä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œå¼‚æ­¥è®¿é—®åˆæˆäº‹ä»¶å±æ€§éœ€ç”¨ `event.persist()`ï¼›
- ç”±äº**å¼‚æ­¥è®¿é—®äº‹ä»¶å±æ€§å¤±æ•ˆ**é—®é¢˜å´ç»å¸¸è®©å¼€å‘è€…å›°æƒ‘ï¼Œåœ¨ React 17 åŠä¹‹åç‰ˆæœ¬å·²ç§»é™¤äº‹ä»¶æ± ï¼Œæ— éœ€è€ƒè™‘äº‹ä»¶å¤ç”¨é—®é¢˜ï¼Œå¼‚æ­¥è®¿é—®å±æ€§ç›´æ¥æœ‰æ•ˆã€‚

:::

### ä¸ºä»€ä¹ˆäº‹ä»¶å§”æ‰˜æ˜¯æŒ‚åœ¨åˆ° rootï¼Œè€Œä¸æ˜¯æŒ‚è½½åˆ° window æˆ–è€… document ä¸Š

æ ¸å¿ƒï¼š**åº”ç”¨éš”ç¦»ï¼Œé¿å…å…¨å±€äº‹ä»¶æ±¡æŸ“**

å› ä¸º react åº”ç”¨æ˜¯æŒ‚è½½åˆ°æ ¹å…ƒç´ ä¸Šçš„ï¼Œåº”ç”¨å†…çš„ä¸œè¥¿ä¸èƒ½å½±å“å†…å®¹å¤–çš„ã€‚

### **ä¸ºä»€ä¹ˆä¸ç”¨åŸç”Ÿäº‹ä»¶ï¼Ÿ**

1. **è·¨æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜**  
   ä¸åŒæµè§ˆå™¨å¯¹åŸç”Ÿäº‹ä»¶çš„å®ç°å­˜åœ¨å·®å¼‚ï¼ˆä¾‹å¦‚ IE ä¸­çš„ `attachEvent` ä¸æ ‡å‡†çš„ `addEventListener`ï¼Œäº‹ä»¶å¯¹è±¡çš„è·å–æ–¹å¼ä¸åŒç­‰ï¼‰ã€‚å¦‚æœç›´æ¥ä½¿ç”¨åŸç”Ÿäº‹ä»¶ï¼Œå¼€å‘è€…éœ€è¦æ‰‹åŠ¨å¤„ç†å¤§é‡å…¼å®¹æ€§é€»è¾‘ï¼Œè€Œ React çš„åˆæˆäº‹ä»¶å·²å†…ç½®äº†è¿™äº›å…¼å®¹å¤„ç†ï¼Œç®€åŒ–å¼€å‘ã€‚

2. **React ç»„ä»¶æ¨¡å‹çš„éœ€è¦**  
   React çš„æ ¸å¿ƒæ˜¯è™šæ‹Ÿ DOMï¼ˆVirtual DOMï¼‰ï¼Œç»„ä»¶çš„ DOM ç»“æ„å¯èƒ½ä¼šè¢«é¢‘ç¹æ›´æ–°ï¼ˆæŒ‚è½½/å¸è½½ï¼‰ã€‚å¦‚æœç›´æ¥ç»‘å®šåŸç”Ÿäº‹ä»¶ï¼Œç»„ä»¶æ›´æ–°æ—¶éœ€è¦æ‰‹åŠ¨è§£ç»‘äº‹ä»¶ä»¥é¿å…å†…å­˜æ³„æ¼ï¼Œè€Œåˆæˆäº‹ä»¶é€šè¿‡å§”æ‰˜åˆ°æ ¹èŠ‚ç‚¹ï¼Œè‡ªåŠ¨ä¸ç»„ä»¶ç”Ÿå‘½å‘¨æœŸåŒæ­¥ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†ã€‚

3. **ç»Ÿä¸€çš„äº‹ä»¶å¤„ç†æœºåˆ¶**  
   åŸç”Ÿäº‹ä»¶çš„è¡Œä¸ºåœ¨ä¸åŒåœºæ™¯ä¸‹å¯èƒ½ä¸ä¸€è‡´ï¼ˆå¦‚äº‹ä»¶å†’æ³¡çš„ç»†èŠ‚ã€äº‹ä»¶ç±»å‹çš„å‘½åå·®å¼‚ï¼‰ã€‚åˆæˆäº‹ä»¶æä¾›äº†ç»Ÿä¸€çš„ APIï¼ˆå¦‚ `onClick`ã€`onChange` ç­‰ï¼‰ï¼Œæ— è®ºåº•å±‚æµè§ˆå™¨å¦‚ä½•å®ç°ï¼Œå¼€å‘è€…åªéœ€éµå¾ª React çš„äº‹ä»¶è§„èŒƒå³å¯ã€‚

æ€»ä¹‹ï¼ŒReact çš„äº‹ä»¶åˆæˆæœºåˆ¶æ˜¯ä¸ºäº†åœ¨ä¿è¯è·¨æµè§ˆå™¨ä¸€è‡´æ€§çš„åŒæ—¶ï¼Œé€‚é… React çš„ç»„ä»¶æ¨¡å‹å’Œæ€§èƒ½éœ€æ±‚ï¼Œå¤§å¹…ç®€åŒ–äº†äº‹ä»¶å¤„ç†é€»è¾‘ã€‚

## é—®é¢˜ 13ï¼šReact Hooks ä¸ Utils çš„åŒºåˆ«

- **React Hooks**ï¼šHooks æ˜¯ React 16.8 æ–°å¢çš„ç‰¹æ€§ï¼Œå…è®¸åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€å’Œå…¶ä»– React ç‰¹æ€§ï¼Œæ‰“ç ´äº†å‡½æ•°ç»„ä»¶åªèƒ½æ¸²æŸ“ UIï¼Œä¸èƒ½ä½¿ç”¨çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸçš„é™åˆ¶ã€‚é€šå¸¸ä»¥ use å¼€å¤´ï¼Œå¦‚ useStateã€useEffectã€useContext ç­‰ã€‚
- **Utils**ï¼šæŒ‡çš„æ˜¯å¼€å‘è€…è‡ªå·±ç¼–å†™çš„ä¸€äº›å·¥å…·å‡½æ•°ï¼Œç”¨äºè§£å†³ç‰¹å®šé—®é¢˜ï¼Œå®ç°æŸäº›é€»è¾‘ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚è¿™äº›å‡½æ•°ä¸ä¾èµ–äº React çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥åœ¨ä»»ä½• JavaScript ç¯å¢ƒä¸­ä½¿ç”¨ã€‚

## é—®é¢˜ 14ï¼šä¸ºä½• dev æ¨¡å¼ä¸‹ useEffect æ‰§è¡Œä¸¤æ¬¡ï¼Ÿ

åœ¨ React 18 çš„ **å¼€å‘æ¨¡å¼** ä¸‹ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ° `useEffect` æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œè¿™æ˜¯ **åˆ»æ„è®¾è®¡çš„è¡Œä¸º**ï¼Œä¸æ˜¯ bugã€‚

**ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Ÿ**

React 18 å¼•å…¥äº† **Strict Modeï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰** çš„å¼€å‘å¢å¼ºåŠŸèƒ½ï¼Œä¼šåœ¨å¼€å‘ç¯å¢ƒä¸­æ¨¡æ‹Ÿ"ç»„ä»¶äºŒæ¬¡æŒ‚è½½"çš„åœºæ™¯ï¼š

- ç¬¬ä¸€æ¬¡æ­£å¸¸æŒ‚è½½
- ç«‹å³"å¸è½½"ç»„ä»¶
- å†æ¬¡é‡æ–°æŒ‚è½½

**å½±å“èŒƒå›´**

- **åªåœ¨å¼€å‘æ¨¡å¼**ä¸‹å‘ç”Ÿï¼Œç”Ÿäº§ç¯å¢ƒä¸ä¼šæœ‰æ­¤è¡Œä¸º
- **åªå½±å“**å¸¦æœ‰å‰¯ä½œç”¨çš„é’©å­ï¼š`useEffect`ã€`useLayoutEffect` ç­‰
- **ä¸å½±å“**çº¯æ¸²æŸ“é€»è¾‘

**å¦‚ä½•é¿å…é‡å¤æ‰§è¡Œ**

1. **æ¸…ç†å‰¯ä½œç”¨**ï¼ˆæ¨èåšæ³•ï¼‰

   ```jsx
   useEffect(() => {
     const timer = setInterval(() => console.log('tick'), 1000)
     return () => clearInterval(timer) // æ¸…ç†å‡½æ•°
   }, [])
   ```

2. **ç§»é™¤ StrictMode**ï¼ˆä¸æ¨èï¼‰

   ```jsx
   // index.js
   ReactDOM.createRoot(rootElement).render(<App />)
   // è€Œä¸æ˜¯ <React.StrictMode><App /></React.StrictMode>
   ```

3. **æ¡ä»¶åˆ¤æ–­**
   ```jsx
   useEffect(() => {
     if (isMounted.current) {
       // æ‰§è¡Œå‰¯ä½œç”¨
     }
     return () => {
       isMounted.current = false
     }
   }, [])
   ```

**æ€»ç»“**

- React 18 å¼€å‘æ¨¡å¼ä¸‹ `useEffect` æ‰§è¡Œä¸¤æ¬¡æ˜¯ **æ­£å¸¸ç°è±¡**
- è¿™æ˜¯ä¸ºäº†å¸®åŠ©ä½ å†™å‡ºæ›´å¥å£®çš„ä»£ç 
- æœ€ä½³å®è·µæ˜¯ **æ­£ç¡®æ¸…ç†å‰¯ä½œç”¨**ï¼Œè€Œä¸æ˜¯ç›²ç›®å¯»æ‰¾"å…³é—­"æ–¹æ³•

## é—®é¢˜ 15ï¼šReact state ä¸å¯å˜æ•°æ®

åœ¨ React ä¸­ï¼Œ**çŠ¶æ€ï¼ˆstateï¼‰çš„ä¸å¯å˜æ€§** æ˜¯æŒ‡ä½ ä¸èƒ½ç›´æ¥ä¿®æ”¹çŠ¶æ€çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å€¼æ¥æ›¿æ¢æ—§çš„çŠ¶æ€ã€‚

ä½¿ç”¨ä¸å¯å˜æ•°æ®å¯ä»¥å¸¦æ¥å¦‚ä¸‹å¥½å¤„ï¼š

1. **æ€§èƒ½ä¼˜åŒ–**

React ä½¿ç”¨æµ…æ¯”è¾ƒï¼ˆshallow comparisonï¼‰æ¥æ£€æµ‹çŠ¶æ€æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚å¦‚æœçŠ¶æ€æ˜¯ä¸å¯å˜çš„ï¼ŒReact åªéœ€è¦æ¯”è¾ƒå¼•ç”¨ï¼ˆå³å†…å­˜åœ°å€ï¼‰æ˜¯å¦å˜åŒ–ï¼Œè€Œä¸éœ€è¦æ·±åº¦éå†æ•´ä¸ªå¯¹è±¡æˆ–æ•°ç»„ã€‚

2. **å¯é¢„æµ‹æ€§**

- ä¸å¯å˜æ•°æ®ä½¿å¾—çŠ¶æ€çš„å˜åŒ–æ›´åŠ å¯é¢„æµ‹å’Œå¯è¿½è¸ªã€‚
- æ¯æ¬¡çŠ¶æ€æ›´æ–°éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡æˆ–æ•°ç»„ï¼Œè¿™æ ·å¯ä»¥æ›´å®¹æ˜“åœ°è°ƒè¯•å’Œè¿½è¸ªçŠ¶æ€çš„å˜åŒ–å†å²ã€‚

3. **é¿å…å‰¯ä½œç”¨**

- ç›´æ¥ä¿®æ”¹çŠ¶æ€å¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„å‰¯ä½œç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¼‚æ­¥æ“ä½œæˆ–å¤æ‚ç»„ä»¶ä¸­ã€‚
- ä¸å¯å˜æ•°æ®ç¡®ä¿äº†çŠ¶æ€çš„æ›´æ–°æ˜¯çº¯å‡½æ•°å¼çš„ï¼Œé¿å…äº†å‰¯ä½œç”¨ã€‚

## é—®é¢˜ 16ï¼šReact state å¼‚æ­¥æ›´æ–°

**react18 å‰**ï¼š

åœ¨ React 18 ä¹‹å‰ï¼ŒReact é‡‡ç”¨æ‰¹å¤„ç†ç­–ç•¥æ¥ä¼˜åŒ–çŠ¶æ€æ›´æ–°ã€‚åœ¨æ‰¹å¤„ç†ç­–ç•¥ä¸‹ï¼ŒReact å°†åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ç»“æŸååº”ç”¨æ‰€æœ‰çš„çŠ¶æ€æ›´æ–°ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„æ¸²æŸ“å’Œ DOM æ“ä½œã€‚

ç„¶è€Œï¼Œè¿™ä¸ªç­–ç•¥åœ¨å¼‚æ­¥æ“ä½œä¸­å°±æ— æ³•å·¥ä½œäº†ã€‚å› ä¸º React æ²¡æœ‰åŠæ³•åœ¨é€‚å½“çš„æ—¶æœºå°†æ›´æ–°åˆå¹¶èµ·æ¥ï¼Œæ‰€ä»¥ç»“æœå°±æ˜¯åœ¨å¼‚æ­¥æ“ä½œä¸­çš„æ¯ä¸€ä¸ªçŠ¶æ€æ›´æ–°éƒ½ä¼šå¯¼è‡´ä¸€ä¸ªæ–°çš„æ¸²æŸ“ã€‚

ä¾‹å¦‚ï¼Œå½“ä½ åœ¨ä¸€ä¸ª onClick äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è¿ç»­è°ƒç”¨ä¸¤æ¬¡ setStateï¼ŒReact ä¼šå°†è¿™ä¸¤ä¸ªæ›´æ–°åˆå¹¶ï¼Œç„¶ååœ¨ä¸€æ¬¡é‡æ–°æ¸²æŸ“ä¸­äºˆä»¥å¤„ç†ã€‚

ç„¶è€Œï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¦‚æœä½ åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¹‹å¤–è°ƒç”¨ setStateï¼ŒReact å°±æ— æ³•è¿›è¡Œæ‰¹å¤„ç†äº†ã€‚æ¯”å¦‚åœ¨ setTimeout æˆ–è€… Promise çš„å›è°ƒå‡½æ•°ä¸­ã€‚åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨ setStateï¼ŒReact éƒ½ä¼šè§¦å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“ï¼Œæ— æ³•è¾¾åˆ°æ‰¹å¤„ç†çš„æ•ˆæœã€‚

---

**react18 å**ï¼š

React 18 å¼•å…¥äº†è‡ªåŠ¨æ‰¹å¤„ç†æ›´æ–°æœºåˆ¶ï¼Œè®© React å¯ä»¥æ•è·æ‰€æœ‰çš„çŠ¶æ€æ›´æ–°ï¼Œå¹¶ä¸”æ— è®ºåœ¨ä½•å¤„è¿›è¡Œæ›´æ–°ï¼Œéƒ½ä¼šå¯¹å…¶è¿›è¡Œæ‰¹å¤„ç†ã€‚è¿™å¯¹ä¸€äº›å¼‚æ­¥çš„æ“ä½œï¼Œå¦‚ Promiseï¼ŒsetTimeout ä¹‹ç±»çš„ä¹ŸåŒæ ·æœ‰æ•ˆã€‚

è¿™ä¸€æ–°ç‰¹æ€§çš„å®ç°ï¼Œæ ¸å¿ƒåœ¨äº React 18 å¯¹æ¸²æŸ“ä¼˜å…ˆçº§çš„ç®¡ç†ã€‚React 18 å¼•å…¥äº†ä¸€ç§æ–°çš„åè°ƒå™¨ï¼Œè¢«ç§°ä¸ºâ€œReact Schedulerâ€ã€‚å®ƒè´Ÿè´£ç®¡ç† React çš„å·¥ä½œå•å…ƒé˜Ÿåˆ—ã€‚æ¯å½“æœ‰ä¸€ä¸ªæ–°çš„çŠ¶æ€æ›´æ–°è¯·æ±‚ï¼ŒReact ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œå•å…ƒå¹¶æ”¾å…¥è¿™ä¸ªé˜Ÿåˆ—ã€‚å½“ JavaScript è¿è¡Œæ ˆæ¸…ç©ºï¼ŒEvent Loop å³å°†å¼€å§‹æ–°çš„ä¸€è½®å¾ªç¯æ—¶ï¼ŒScheduler å°±ä¼šè¿›å…¥å·¥ä½œï¼Œå¤„ç†é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å·¥ä½œå•å…ƒï¼Œå®ç°äº†æ‰¹å¤„ç†ã€‚

## é—®é¢˜ 17ï¼šHooks ä½¿ç”¨çš„é™åˆ¶

1. ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hooks
2. åªèƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ Hooks

## é—®é¢˜ 18ï¼šReact19 å‡çº§äº†å“ªäº›æ–°ç‰¹æ€§ï¼Ÿ

1. æ–°çš„ API: `use`

åœ¨ React 19 ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ API æ¥åœ¨æ¸²æŸ“ä¸­è¯»å–èµ„æºï¼šuseã€‚

ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ use è¯»å–ä¸€ä¸ª promiseï¼ŒReact å°†æŒ‚èµ·ï¼Œç›´åˆ° promise è§£æå®Œæˆï¼š

```jsx
import { use } from 'react'

function Comments({ commentsPromise }) {
  // `use` å°†è¢«æš‚åœç›´åˆ° promise è¢«è§£å†³.
  const comments = use(commentsPromise)
  return comments.map((comment) => <p key={comment.id}>{comment}</p>)
}

function Page({ commentsPromise }) {
  // å½“â€œuseâ€åœ¨æ³¨é‡Šä¸­æš‚åœæ—¶,
  // å°†æ˜¾ç¤ºæ­¤æ‚¬å¿µè¾¹ç•Œã€‚
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Comments commentsPromise={commentsPromise} />
    </Suspense>
  )
}
```

2. ref ä½œä¸ºä¸€ä¸ªå±æ€§

ä» React 19 å¼€å§‹ï¼Œä½ ç°åœ¨å¯ä»¥åœ¨å‡½æ•°ç»„ä»¶ä¸­å°† ref ä½œä¸º prop è¿›è¡Œè®¿é—®ï¼š

```jsx
function MyInput({ placeholder, ref }) {
  return (
    <input
      placeholder={placeholder}
      ref={ref}
    />
  )
}

//...
;<MyInput ref={ref} />
```

æ–°çš„å‡½æ•°ç»„ä»¶å°†ä¸å†éœ€è¦ `forwardRef`ã€‚

## é—®é¢˜ 19ï¼šuseDeferredValue å’Œ useTransition çš„åŒºåˆ«

useDeferredValue å’Œ useTransition éƒ½æ˜¯ React 18 å¼•å…¥çš„å¹¶å‘ç‰¹æ€§ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ä¼˜åŒ–é•¿ä»»åŠ¡å¯¼è‡´çš„ UI é˜»å¡é—®é¢˜

- `useDeferredValue`ï¼šä¼˜åŒ–ã€Œ**çŠ¶æ€çš„æ¸²æŸ“ä¼˜å…ˆçº§**ã€â€”â€” è®©ä¸€ä¸ª â€œéç´§æ€¥â€ çŠ¶æ€çš„æ›´æ–°å»¶è¿Ÿæ‰§è¡Œï¼Œä¼˜å…ˆä¿è¯ç´§æ€¥çŠ¶æ€ï¼ˆå¦‚è¾“å…¥ã€ç‚¹å‡»ï¼‰çš„å“åº”æ€§ã€‚è¿™å¯¹äºé«˜é¢‘æ›´æ–°çš„å†…å®¹(å¦‚è¾“å…¥æ¡†ã€æ»šåŠ¨ç­‰)éå¸¸æœ‰ç”¨

```jsx
const deferredContent = useDeferredValue(content) // content ä¸ºç¼–è¾‘åŒºæºå†…å®¹
return <Preview content={deferredContent} />
```

- `useTransition`ï¼šä¼˜åŒ–ã€Œ**æ›´æ–°æ“ä½œçš„ä¼˜å…ˆçº§**ã€â€”â€” æŠŠä¸€ä¸ª â€œéç´§æ€¥â€ çš„æ›´æ–°æ“ä½œæ ‡è®°ä¸º â€œè¿‡æ¸¡ä»»åŠ¡â€ï¼Œè®©å®ƒåœ¨åå°ä½ä¼˜å…ˆçº§æ‰§è¡Œï¼Œä¸é˜»å¡ç´§æ€¥æ“ä½œã€‚å®ƒå¸¸ç”¨äºä¼˜åŒ–è§†å›¾åˆ‡æ¢æ—¶çš„ç”¨æˆ·ä½“éªŒï¼ˆå¦‚ tab åˆ‡æ¢ï¼‰ã€‚

```js
const [isPending, startTransition] = useTransition()

// startTransitionåŒ…è£¹éœ€è¦æ›´æ–°çŠ¶æ€ä»£ç 
startTransition(() => {
  setCount(1)
})
```

> âš ï¸ æ³¨æ„ï¼šä¼ é€’ç»™ `startTransition` çš„å‡½æ•°å¿…é¡»æ˜¯åŒæ­¥çš„ï¼ŒReact ä¼šç«‹å³æ‰§è¡Œæ­¤å‡½æ•°

## é—®é¢˜ 20ï¼šåœ¨ useState çš„ setState æ“ä½œä¸­ï¼Œå¦‚æœå‡½æ•°çš„è¿”å›å€¼æ˜¯æµ…æ‹·è´æˆ–æ·±æ‹·è´ï¼Œå¯¹æ¸²æŸ“æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ

### ç°è±¡ 1

```tsx
import React from 'react'
import { cloneDeep } from 'lodash-es'

const Component = () => {
  const [state, setState] = React.useState([
    { id: 1, name: 'name1' },
    { id: 2, name: 'name2' }
  ])

  const handleClick = () => {
    setState((prevState) => [...prevState])
  }
  const handleClick2 = () => {
    setState((prevState) => cloneDeep(prevState))
  }

  return (
    <div>
      <button onClick={handleClick}>æµ…æ‹·è´</button>
      <button onClick={handleClick2}>æ·±æ‹·è´</button>
      {state.map((item) => (
        <div key={item.id}>{item.name}</div>
      ))}
      <hr />
      {state.map((item) => (
        <ListItem key={item.id} />
      ))}
    </div>
  )
}

const ListItem = () => {
  return (
    <div>
      <div>name</div>
    </div>
  )
}

export default Component
```

å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œæ¸²æŸ“çš„æ˜¯ domï¼Œæ— è®ºæ˜¯æ·±æ‹·è´è¿˜æ˜¯æµ…æ‹·è´ï¼Œkey å€¼ä¸å˜ï¼Œæ‰€ä»¥ä¸ä¼šé‡æ–°æ¸²æŸ“ï¼›

ä½†æ˜¯å¦‚æœæ¸²æŸ“çš„æ˜¯ç»„ä»¶ï¼Œé‚£ä¹ˆæµ…æ‹·è´å’Œæ·±æ‹·è´éƒ½ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚

> âš ï¸ æ³¨æ„ï¼šReact çš„ key å±æ€§æ˜¯ç”¨æ¥ä¼˜åŒ–åˆ—è¡¨æ¸²æŸ“çš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¸®åŠ© React è¯†åˆ«å“ªäº›å…ƒç´ æ˜¯æ–°å¢ã€åˆ é™¤æˆ–ç§»åŠ¨çš„ï¼Œè€Œä¸æ˜¯ç”¨æ¥é˜»æ­¢ç»„ä»¶é‡æ–°æ¸²æŸ“çš„ã€‚

React çš„çŠ¶æ€æ›´æ–°æœºåˆ¶æ˜¯åŸºäºå¼•ç”¨å¯¹æ¯”çš„ï¼šå½“ä½ è°ƒç”¨ `setState` æ—¶ï¼Œæ— è®ºè¿”å›çš„æ˜¯æµ…æ‹·è´ï¼ˆ`[...prevState]`ï¼‰è¿˜æ˜¯æ·±æ‹·è´ï¼ˆ`cloneDeep(prevState)`ï¼‰ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°ç»„å¼•ç”¨ã€‚

ğŸ¤” **é‚£ä¸ºä»€ä¹ˆ dom å…ƒç´ ä¸ä¼šé‡æ–°æ¸²æŸ“ï¼Œè€Œå­ç»„ä»¶ä¼šå‘¢ï¼Ÿ**

- **åŸç”Ÿ DOM å…ƒç´ **ï¼š
  ç‚¹å‡»æŒ‰é’®åï¼Œçˆ¶ç»„ä»¶é‡æ¸²æŸ“ï¼Œä½†æµè§ˆå™¨å¹¶æ²¡æœ‰é‡æ–°åˆ›å»º / é”€æ¯è¿™äº› div å…ƒç´ ï¼Œå› ä¸º React é€šè¿‡ key è¯†åˆ«å‡ºè¿™æ˜¯åŒä¸€ä¸ªå…ƒç´ ï¼Œåªæ˜¯æ£€æŸ¥å…¶å†…å®¹æ˜¯å¦å˜åŒ–ï¼ˆ`item.name` æ²¡å˜ï¼‰ï¼Œæ‰€ä»¥åªåšè™šæ‹Ÿ DOM çš„å¯¹æ¯”ï¼Œä¸ä¼šè§¦å‘çœŸå® DOM çš„é‡æ–°æ¸²æŸ“ï¼ˆè¿™æ˜¯ä½ æ„ŸçŸ¥ä¸åˆ° DOM é‡æ–°æ¸²æŸ“çš„åŸå› ï¼‰ã€‚
- **è‡ªå®šä¹‰å­ç»„ä»¶ ListItem**ï¼š
  ç‚¹å‡»æŒ‰é’®åï¼ŒListItem ä¸€å®šä¼šé‡æ–°æ¸²æŸ“ã€‚åŸå› æ˜¯ï¼šçˆ¶ç»„ä»¶é‡æ¸²æŸ“æ—¶ï¼Œä¼šé‡æ–°ç”Ÿæˆ`<ListItem key={item.id} />`è¿™ä¸ª JSX å…ƒç´ ã€‚**React é»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦çˆ¶ç»„ä»¶é‡æ¸²æŸ“ï¼Œæ‰€æœ‰å­ç»„ä»¶éƒ½ä¼šè·Ÿç€é‡æ¸²æŸ“**ï¼ˆé™¤éå­ç»„ä»¶åšäº†æ€§èƒ½ä¼˜åŒ–ï¼‰ï¼Œ**key åªæ˜¯ä¿è¯ React ä¸ä¼šé”€æ¯é‡å»ºå­ç»„ä»¶å®ä¾‹ï¼ˆé¿å…ä¸¢å¤±çŠ¶æ€ï¼‰ï¼Œä½†æ— æ³•é˜»æ­¢å­ç»„ä»¶çš„é‡æ¸²æŸ“é€»è¾‘æ‰§è¡Œ**

### ç°è±¡ 2

æ­¤æ—¶æˆ‘ä»¬éœ€è¦ç»™ `ListItem` æ·»åŠ  `React.memo` ä¼˜åŒ–æ€§èƒ½ï¼š

```tsx
const ListItem = React.memo(
  ({ item }: { item: { id: number; name: string } }) => {
    return (
      <div>
        <div>
          {item.name}-{item.id}
        </div>
      </div>
    )
  }
)
```

è¿™æ ·çš„è¯ï¼Œå­ç»„ä»¶æµ…æ‹·è´å°±ä¸ä¼šé‡æ–°æ¸²æŸ“ï¼Œè€Œæ·±æ‹·è´ä¸€æ ·ä¼šé‡æ–°æ¸²æŸ“ã€‚

ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å› ä¸º React.memo çš„æœ¬è´¨æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šç¼“å­˜ç»„ä»¶çš„æ¸²æŸ“ç»“æœï¼Œåªæœ‰å½“ç»„ä»¶çš„ props å‘ç”Ÿã€Œå¯æ£€æµ‹çš„å˜åŒ–ã€æ—¶ï¼Œæ‰é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚

ä½†å…³é”®åœ¨äºï¼š**React.memoé»˜è®¤ä½¿ç”¨çš„æ˜¯æµ…å¯¹æ¯”**ï¼Œè€Œéã€Œæ·±å¯¹æ¯”ã€ã€‚